# Trading Exchange Engine - MVP Phase 1 체크리스트

## 0. 범위 고정

> MVP Phase 1에서 구현하는 범위를 명확히 제한한다.

- 단일 종목(`TEST`)만 다룬다
- 주문 타입은 LIMIT만 허용한다 (MARKET 금지)
- TIF는 GTC 고정이다
- DB / 메시징 / WebSocket / 분산 / 잔고검증은 구현하지 않는다

## 1. 도메인 모델 구현

### 1.1 Value Object / Enum

| 대상 | 핵심 불변식 |
|------|-------------|
| `OrderId` | UUID 기반 생성 |
| `Side` | BUY / SELL |
| `OrderStatus` | ACCEPTED → NEW → PARTIALLY_FILLED / FILLED / CANCELLED |
| `Price` | long, ≥ 1 |
| `Quantity` | long, ≥ 0 (remaining 표현 포함) |

- [x] `OrderId` 생성 규칙 확정 및 구현
- [x] `Side` 구현
- [x] `OrderStatus` 구현
- [x] `Price` 불변식 검증 구현
- [x] `Quantity` 불변식 검증 구현

### 1.2 Order (Entity)

필드: `orderId`, `side`, `price`, `quantity`, `remaining`, `status`

- [x] 생성 시 검증: `quantity >= 1`, `price >= 1`
- [x] `fill(executedQty)` — remaining 차감 + 상태 전이
- [x] `cancel()` — 취소 가능 상태(NEW / PARTIALLY_FILLED)만 허용
- [x] 종료 상태(FILLED / CANCELLED) 이후 변경 불가 보장

## 2. OrderBook 구현

- [x] `bids`: 가격 내림차순 정렬
- [x] `asks`: 가격 오름차순 정렬
- [x] 동일 가격 레벨 FIFO 큐
- [x] `bestBid / bestAsk` 조회
- [x] 주문 추가(`add`)
- [x] 체결 완료 주문 제거(`poll`)
- [x] (선택) 취소를 위한 제거(`remove by orderId`)

## 3. MatchingEngine 구현

- [x] 단일 스레드에서만 상태 변경이 일어나도록 설계
- [x] `placeLimitOrder(order)` 구현
  - [x] BUY: `bestAsk.price <= buy.price` 동안 반복 매칭
  - [x] SELL: `bestBid.price >= sell.price` 동안 반복 매칭
  - [x] 체결 수량: `min(taker.remaining, maker.remaining)`
  - [x] 체결 가격: maker 가격
  - [x] 미체결 잔량 존재 시 OrderBook에 등록
- [x] `cancelOrder(orderId)` 구현

## 4. API 구현

| 엔드포인트                      | 설명 |
|----------------------------|:-----|
| `POST /orders`             | 주문 생성 → `{orderId, status: ACCEPTED}` |
| `DELETE /orders/{orderId}` | 주문 취소 |
| `GET /orders/{orderId}`    | 주문 상태 / 잔량 조회 |
| `GET /orderbook`           | 호가(depth) 조회 |

- [x] `POST /orders`
- [x] `DELETE /orders/{orderId}`
- [x] `GET /orders/{orderId}`
- [x] `GET /orderbook`

## 5. 정합성 테스트

- [x] 가격 우선 — 유리한 가격이 먼저 체결됨을 검증
- [x] 동일 가격 FIFO — 먼저 접수된 주문이 먼저 체결됨을 검증
- [x] 부분 체결 — remaining 감소 + `PARTIALLY_FILLED` 전이
- [x] 전량 체결 — `FILLED`, `remaining = 0`
- [x] 취소 — NEW / PARTIALLY_FILLED만 취소 가능
- [x] 종료 상태 불변 — FILLED / CANCELLED 이후 변경 시 예외 발생

## 6. 시뮬레이션 / 불변식 검증

랜덤 주문 10만 건 입력 후 아래 항목 모두 0건이어야 한다.

- [x] 가격 우선 위반
- [x] FIFO 위반
- [x] remaining 음수
- [x] 상태 전이 위반

## 7. 완료 기준 (Definition of Done)

| 기준 | 조건 |
|------|------|
| 단위 테스트 | 전체 통과 |
| 통합 흐름 | 주문 생성 → 체결 → 조회 정상 동작 |
| 안정성 | 단일 프로세스에서 예외 없이 동작 |
| 범위 준수 | MVP Phase 1 외 기능 미포함 |

- [x] 단위 테스트 전체 통과
- [x] 주문 생성 → 체결 → 조회 흐름 정상
- [x] 단일 프로세스에서 안정적으로 동작
- [x] MVP Phase 1 범위 외 기능이 포함되지 않음
